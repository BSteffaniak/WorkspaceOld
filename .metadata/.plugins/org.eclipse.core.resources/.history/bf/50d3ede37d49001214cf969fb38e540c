package net.foxycorndog.glshaderide.treemenu;

import java.util.ArrayList;
import java.util.HashMap;

import org.eclipse.swt.SWT;
import org.eclipse.swt.custom.ScrolledComposite;
import org.eclipse.swt.events.ControlEvent;
import org.eclipse.swt.events.ControlListener;
import org.eclipse.swt.graphics.Rectangle;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Event;
import org.eclipse.swt.widgets.Listener;
import org.eclipse.swt.widgets.Shell;
import org.eclipse.swt.widgets.Tree;
import org.eclipse.swt.widgets.TreeItem;

public class TreeMenu
{
	private Composite composite;
	
	private Tree  tree;
	
	private Shell shell;
	
	private HashMap<Integer, TreeItem> items;
	
	private ArrayList<TreeMenuListener> listeners;
	
	private static int staticId;
	
	static
	{
		staticId = 0;
	}
	
	public TreeMenu(final Shell shell)
	{
		final ScrolledComposite sc = new ScrolledComposite(shell, SWT.H_SCROLL | SWT.V_SCROLL);
		
		composite = new Composite(sc, SWT.NONE);
		
		sc.setContent(composite);
		
		sc.setExpandHorizontal(true);
		sc.setExpandVertical(true);
		
		sc.addControlListener(new ControlListener()
		{
			public void controlMoved(ControlEvent e)
			{
				
			}

			public void controlResized(ControlEvent e)
			{
				Rectangle r = sc.getClientArea();
				
				sc.setMinSize(shell.computeSize(r.width, SWT.DEFAULT));
			}
		});
		
		tree      = new Tree(composite, SWT.NONE);
		
		items     = new HashMap<Integer, TreeItem>();
		
		listeners = new ArrayList<TreeMenuListener>();
	}
	
	public int addItem(String name)
	{
		final int id = ++staticId;
		
		TreeItem item = new TreeItem(tree, SWT.NONE);
		item.setText(name);
		
		items.put(id, item);
		
		item.addListener(SWT.Selection, new Listener()
		{
			public void handleEvent(Event e)
			{
				for (int i = listeners.size() - 1; i >= 0; i --)
				{
					listeners.get(i).treeItemSelected(id);
				}
			}
		});
		
		return id;
	}
	
	public int addSubItem(int parent, String name)
	{
		final int id = ++staticId;
		
		TreeItem item = new TreeItem(items.get(parent), SWT.NONE);
		item.setText(name);
		
		items.put(id, item);
		
		item.addListener(SWT.Selection, new Listener()
		{
			public void handleEvent(Event e)
			{
				for (int i = listeners.size() - 1; i >= 0; i --)
				{
					listeners.get(i).treeItemSelected(id);
				}
			}
		});
		
		return id;
	}
	
	public void addListener(TreeMenuListener listener)
	{
		listeners.add(listener);
	}
	
	public int getWidth()
	{
		return composite.getBounds().width;
	}
	
	public int getHeight()
	{
		return composite.getBounds().height;
	}
	
	public void setSize(int width, int height)
	{
		composite.getParent().setSize(width, height);
		composite.setSize(width, height);
		tree.setSize(width, height);
	}
	
	public void setLocation(int x, int y)
	{
		composite.getParent().setSize(x, y);
		composite.setLocation(x, y);
	}
}