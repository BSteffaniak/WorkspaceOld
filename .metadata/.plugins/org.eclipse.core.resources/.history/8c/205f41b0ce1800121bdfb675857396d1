package net.foxycorndog.shoot.actor;
import net.foxycorndog.jdoogl.GL;
import net.foxycorndog.jdoogl.camera.Camera;
import net.foxycorndog.jdoutil.Buffer;
import net.foxycorndog.jdoutil.VerticesBuffer;
import net.foxycorndog.shoot.map.Map;

import java.nio.FloatBuffer;

/**
 * We use keyboard and mouse input values to build a view matrix which gets
 * loaded instead of the existing modelview matrix. We also attach a simple
 * white square which moves with the camera as if it were a gun.
 */
public class Player
{
	private int     perspective;
	
	private Camera  camera;
	
	public  static final int   THIRD = 3, FIRST = 1;
	
	public Player(float width, float height, float depth, float centerX, float centerY, float centerZ, Map map)
	{
		this.width   = width;
		this.height  = height;
		this.depth   = depth;
		
		this.centerX = centerX;
		this.centerY = centerY;
		this.centerZ = centerZ;
		
		this.offsetX = centerX;
		this.offsetY = centerY;
		this.offsetZ = centerZ;
		
		this.map     = map;
		
		camera       = new Camera();
		
		camera.move(centerX, centerY, centerZ);
		
		setPerspective(THIRD);
		
		verticesBuffer = new VerticesBuffer(3 * 4 * 6);
		verticesBuffer.addData(GL.addCubeVertexArrayf(0, 0, 0, width, height, depth, 0, null));
	}
	
	public boolean move(int direction, float distance)
	{
		if (super.move(direction, distance))
		{
			
			
			return true;
		}
		
		return false;
	}
	
	public boolean move(float dx, float dy, float dz)
	{
		camera.move(dx, dy, dz);
		
		if (collided(map))
		{
			camera.move(-dx, -dy, -dz);
			
			return false;
		}
		
		return true;
	}
	
	public void lookThrough()
	{
		GL.translatef(-offsetX + centerX, -offsetY + centerY, -offsetZ + centerZ);
		
		camera.lookThrough();

		GL.translatef(offsetX - centerX, offsetY - centerY, offsetZ - centerZ);
	}
	
	public void pitch(float amount)
	{
		camera.pitch(amount);
	}
	
	public void yaw(float amount)
	{
		camera.yaw(amount);
	}
	
	public void render()
	{
		GL.beginManipulation();
		{
			GL.setColori(25, 25, 25, 255);
			
			GL.translatef(-offsetX + camera.getX(), -offsetY + camera.getY(), -offsetZ + camera.getZ());
			
			GL.translatef(centerX, centerY, centerZ);
			
			GL.rotatef(0, -camera.getYaw(), 0);
			
			GL.translatef(-centerX, -centerY, -centerZ);
			
			GL.renderCubes(verticesBuffer, 0, 1);
		}
		GL.endManipulation();
	}
	
	public void setPerspective(int perspective)
	{
		if (this.perspective == perspective)
		{
			return;
		}
		
		if (perspective == THIRD)
		{
			offsetZ += 6;
			offsetY += 2;
			
			camera.move(0, 0, 6);
			camera.move(0, 2, 0);
		}
		else if (perspective == FIRST)
		{
			offsetZ -= 6;
			offsetY -= 2;
			
			camera.move(0, 0, -6);
			camera.move(0, -2, 0);
		}
	}
}