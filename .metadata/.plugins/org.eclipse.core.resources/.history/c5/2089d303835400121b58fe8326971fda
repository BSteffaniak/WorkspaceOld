package net.foxycorndog.arrowide.components;

import java.util.ArrayList;

import org.eclipse.swt.SWT;
import org.eclipse.swt.custom.StyledText;
import org.eclipse.swt.events.PaintEvent;
import org.eclipse.swt.events.PaintListener;
import org.eclipse.swt.widgets.Composite;

import static net.foxycorndog.arrowide.ArrowIDE.PROPERTIES;

public class ConsoleField extends StyledText
{
	private boolean textUpdated;

	private ArrayList<String> appendQueue;
	
	public ConsoleField(Composite parent)
	{
		super(parent, SWT.MULTI | SWT.V_SCROLL | SWT.H_SCROLL | (Integer)PROPERTIES.get("composite.modifiers"));
		
		appendQueue           = new ArrayList<String>();
		
		addPaintListener(new PaintListener()
	    {
			public void paintControl(PaintEvent e)
			{
				synchronized (appendQueue)
				{
					while (appendQueue.size() > 0)
					{
						append(appendQueue.remove(0), true);
						
						textUpdated = true;
					}
				}
			}
	    });
	}
	
	public void append(String s)
	{
		append(s, false);
	}
	
	public void append(String s, boolean sup)
	{
		if (sup)
		{
			super.append(s);
		}
		else
		{
			synchronized (appendQueue)
			{System.out.println("adding: " + s);
				appendQueue.add(s);
			}
		}
	}
	
	public void updateText()
	{
		if (textUpdated)
		{
			redraw();
			
			textUpdated = false;
		}
	}
}