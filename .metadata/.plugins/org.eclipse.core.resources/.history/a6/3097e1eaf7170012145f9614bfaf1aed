import java.util.ArrayList;
import java.util.Collections;

/**
 * File:          Company.java
 * Author:        Braden Steffaniak
 * Programming:   APCS
 * Last Modified: 6Sep2012
 * Description:   Class that holds the information of the
 * curve. And can negotiate.
 */
public class Company
{
	private long  nextQuantity;
	
	private Point currentPoint;
	
	private Curve curve;
	
 	/**
	 * Constructor for the slope and stuff.
	 */
	public Company(double m, double b, int x, int num)
	{
		curve = new Curve(m, b, x, num);
	}
	
	public Company(Point points[])
	{
		curve = new Curve(points);
	}
	
	/**
	 * Returns the initial bid for this curve.
	 */
	public Point initialBid()
	{
		nextQuantity = -1;
		
		Point point = curve.nextPoint(nextQuantity);
		
		nextQuantity = point.getQuantity();
		
		return point;
	}
	
	/**
	 * Method used to see if this curve will accept the bid.
	 */
	public Point negotiate(Point p)
	{
		double distX = 0, distY = 0;
		
		Rectangle tol1 = null, tol2 = null;
		
		if (nextQuantity < curve.size())
		{
			distX = curve.getPoint(nextQuantity).getQuantity() -
					curve.getPoint(nextQuantity - 1).getQuantity();
			distY = curve.getPoint(nextQuantity).getQuantity() -
					curve.getPoint(nextQuantity - 1).getQuantity();
		
			tol2  = new Rectangle(curve.getPoint(nextQuantity)
					.getQuantity() - distX / 2, curve.getPoint(nextQuantity)
					.getCost() - distY / 2, distX, distY);
		}
			
		tol1 = new Rectangle(curve.getPoint(nextQuantity - 1)
				.getQuantity() - distX / 2, curve.getPoint(nextQuantity
				- 1).getCost() - distY / 2, distX, distY);
		
		if (tol2 != null)
		{
			if (Market.equilibrium(p, tol1, tol2))
			{
				return p;
			}
		}
		else
		{
			if (Market.equilibrium(p, tol1))
			{
				return p;
			}
		}
		
		if (nextQuantity - 1 < curve.size())
		{
			return curve.getPoint(nextQuantity - 1);
		}
		else
		{
			return null;
		}
	}
	
	/**
	 * The to string. returns the curves points.
	 */
	public String toString()
	{
		return curve.toString();
	}
}